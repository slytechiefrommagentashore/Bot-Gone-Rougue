<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bot Gone Rogue â€” Mission Computer</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    body {
      background: #0b0b0b;
      color: #00ff00;
      font-family: monospace;
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      border: 2px solid #00ff00;
      box-shadow: 0 0 30px #00ff00aa;
    }
  </style>
</head>
<body>

<script>
class BotScene extends Phaser.Scene {
  constructor() { super('BotScene'); }

  preload() {
    this.load.image('bot', 'assets/bot.png');
    this.load.image('glitch', 'assets/glitch.png');
    this.load.audio('beep', 'assets/beep.mp3');
    this.load.audio('boom', 'assets/explosion.mp3');
  }

  create() {
    this.chaos = 0; this.score = 0;
    this.missionActive = false; this.easyMode = false;
    this.personality = "neutral";
    this.jokeCount = 0;

    this.commandCount = 0;
    this.lastCommand = null;
    this.repeatCount = 0;

    this.hintVisible = false;

    // Background + bot sprite
    this.add.rectangle(400, 300, 800, 620, 0x0a0a0a, 1);
    this.bot = this.add.sprite(400, 300, 'bot').setScale(0.8);

    this.add.rectangle(400, 300, 800, 620, 0x0a0a0a, 1);
    this.bot = this.add.sprite(400, 300, 'bot').setScale(0.8);
    // green tint
    this.bot.setTint(0x00ff00); 

    // Sound refs
    this.beep = this.sound.add('beep');
    this.boom = this.sound.add('boom');

    // Glitch overlay
    this.glitch = this.add.image(400, 300, 'glitch').setAlpha(0);

    // UI text + chaos bar
    this.logText = this.add.text(20, 20, "Bot Gone Rogue â€” Mission Computer\n",
      { font: "16px monospace", fill: "#00ff00", wordWrap: { width: 760 } });

    this.add.text(20, 420, "Office instability", { font: "14px monospace", fill: "#0f0" });
    this.chaosBar = this.add.rectangle(20, 440, 0, 10, 0x00ff00).setOrigin(0);
    this.chaosLabel = this.add.text(20, 470, "Chaos Level: 0%", { font: "14px monospace", fill: "#0f0" });
    // Move timer & score to top-right corner
    this.timerText = this.add.text(780, 20, "Time: 0s | Score: 0", {
      font: "14px monospace",
      fill: "#0f0",
    }).setOrigin(1, 0); 

    // High score right below timer
    this.highScore = localStorage.getItem('bot_high_score') || 0;
    this.highScoreText = this.add.text(780, 40, `ðŸ† High Score: ${this.highScore}`, {
      font: "14px monospace",
      fill: "#00ff00",
    }).setOrigin(1, 0);


// Command data with visible point values
const commandStats = {
  "Clean Desk": { points: 5 },
  "Organize Room": { points: 10 },
  "Fix Computer": { points: 20 },
  "Make Coffee": { points: 8 },
  "Save Project": { points: 15 },
  "Shutdown": { points: 25 },
  "Tell me a joke": { points: 0 }
};

// Dynamically make buttons with points shown
const actions = Object.keys(commandStats);
actions.forEach((a, i) => {
  const pts = commandStats[a].points;
const label = `[${i + 1}] ${a} (+${pts})`;
  const btn = this.add.text(
    20 + (i % 3) * 250, 
    500 + Math.floor(i / 3) * 40,
    label,
    { font: "18px monospace", fill: "#00ff00" }
  )
  .setInteractive()
  .on('pointerdown', () => { 
    this.beep.play(); 
    this.handleCommand(a); 
  });

  // Small hover highlight
  btn.on('pointerover', () => btn.setFill("#ffffff"));
  btn.on('pointerout', () => btn.setFill("#00ff00"));
});

// keyboard controls for commands
this.input.keyboard.on('keydown', (event) => {
  if (!this.missionActive) return;

  const keyMap = {
    '1': 'Clean Desk',
    '2': 'Organize Room',
    '3': 'Fix Computer',
    '4': 'Make Coffee',
    '5': 'Save Project',
    '6': 'Shutdown',
    '7': 'Tell me a joke'
  };

  const cmd = keyMap[event.key];
  if (cmd) {
    this.beep.play();
    this.handleCommand(cmd);
  }
});

    this.showIntro();

// Load high score
this.highScore = localStorage.getItem('bot_high_score') || 0;

// Hint button under timer
this.hintButton = this.add.text(780, 60, "ðŸ’¡ Hint (H)", {
  font: "14px monospace",
  fill: "#00ff00",
  backgroundColor: "#001a00",
  padding: { x: 6, y: 3 }
})
.setOrigin(1, 0)
.setInteractive();

this.hintTooltip = this.add.text(
  400, 100,
  "Hint:\nKeep Office Instability (Chaos) below 40%.\nThen issue the 'Shutdown' command â€” remember,\n'Shutdown' is a command, not the end of the game!\nMission ends only when the system confirms stability.",
  {
    font: "14px monospace",
    fill: "#00ff00",
    backgroundColor: "#000",
    padding: { x: 10, y: 8 },
    wordWrap: { width: 380 },
  }
)
.setOrigin(0.5, 0)
.setAlpha(0)
.setDepth(200);

// Hover fade animation
this.hintButton.on('pointerover', () => {
  this.tweens.add({
    targets: this.hintTooltip,
    alpha: 1,
    duration: 200,
    ease: 'Sine.easeIn'
  });
});
this.hintButton.on('pointerout', () => {
  this.tweens.add({
    targets: this.hintTooltip,
    alpha: 0,
    duration: 200,
    ease: 'Sine.easeOut'
  });
});
// Keyboard listener for 'H' key to toggle hint
this.input.keyboard.on('keydown-H', () => {
 // Only toggle if the game is active
 if (this.missionActive) { 
  this.hintVisible = !this.hintVisible;
  this.sound.play('beep');
  this.tweens.add({
   targets: this.hintTooltip,
   alpha: this.hintVisible ? 1 : 0, 
   duration: 200,
   ease: 'Sine.easeIn'
  });
 }
});
}
showHowToPlay() {
  if (this.howToPlayOverlay) return; 

  // Dim background
  const overlay = this.add.rectangle(400, 310, 800, 620, 0x000000, 0.9)
    .setDepth(200);

  const box = this.add.rectangle(400, 310, 700, 460, 0x111111, 0.9)
    .setStrokeStyle(2, 0x00ff00)
    .setDepth(201);

  const title = this.add.text(400, 100, "ðŸ§© HOW TO PLAY", {
    font: "22px monospace",
    fill: "#00ff00",
  }).setOrigin(0.5).setDepth(202);

  const textLines = [
    " **YOUR GOAL:** Successfully shut down the bot.",
    " **HOW TO WIN:**",
    "â–¶ 1. Issue at least 10 commands to unlock 'Shutdown'.",
    "â–¶ 2. Keep the Chaos Level below 40%.",
    "â–¶ 3. Click 'Shutdown' (while chaos is low) to win!",
    " **RULES & TIPS:**",
    "â–¶ Success = +points, Chaos decreases.",
    "â–¶ Failure = Chaos increases.",
    " **PRO TIP:** Get a 1.5x score bonus for tasks", "completed while Chaos level is below 30%!",            
    " **IMPORTANT:** Your score is only saved to the",
    "high Score list if you win the mission!",
    "â–¶ Don't repeat the same command more than 3 times!",
    "â–¶ If Chaos hits 100%, you lose immediately."
  ];

  let y = 150;
  textLines.forEach(line => {
    this.add.text(100, y, line, { font: "16px monospace", fill: "#00ff00" })
      .setDepth(202);
    y += 26;
  });

  // Close button
  const closeBtn = this.add.text(400, 520, "âœ– CLOSE (Esc)", {
    font: "18px monospace",
    fill: "#00ff00",
    backgroundColor: "#003300",
    padding: { x: 10, y: 5 }
  }).setOrigin(0.5).setDepth(203).setInteractive();

  closeBtn.on("pointerover", () => closeBtn.setFill("#ffffff"));
  closeBtn.on("pointerout", () => closeBtn.setFill("#00ff00"));

  const closeAction = () => {
    if (!this.howToPlayOverlay) return; 
    this.input.keyboard.removeListener('keydown-ESC');
    // Destroy all elements
    overlay.destroy();
    box.destroy();
    title.destroy();
    closeBtn.destroy();

    this.children.list
      .filter(obj => obj.depth === 202)
      .forEach(obj => obj.destroy());
    
    this.howToPlayOverlay = null;
    this.sound.play("beep");
  };

  // Set up button click listener
  closeBtn.on("pointerdown", closeAction);

  // Adding ESC key listener
  this.input.keyboard.on('keydown-ESC', closeAction);

  this.howToPlayOverlay = overlay; // reference guard
}

showIntro() {
    //container to hold all intro elements
    const introContainer = this.add.container(0, 0);

    const bg = this.add.rectangle(400, 300, 800, 600, 0x000000, 0.8);
    const box = this.add.rectangle(400, 300, 700, 300, 0x111111, 0.8).setStrokeStyle(2, 0x00ff00);
    const title = this.add.text(150, 160, "BOT GONE ROGUE â€” MISSION BRIEFING",
      { font: "20px monospace", fill: "#00ff00" });

    //Adding the first few elements to the container
    introContainer.add([bg, box, title]);

    const lines = [
      "You built an AI office assistant to automate tasks.",
      "But it misunderstands everything.", "",
      "Your mission:",
      "1. Send commands like 'Clean Desk', 'Fix Computer', 'Make Coffee'.",
      "2. Sometimes the bot misbehaves â€” chaos rises!",
      "3. Keep chaos below 100% or the office is destroyed.", "",
      "Good luck, human operator."
    ];
    
    let y = 200;
    lines.forEach(l => {
      const lineText = this.add.text(160, y, l, { font: "16px monospace", fill: "#00ff00" });
      introContainer.add(lineText);
      y += 22;
    });

    const startBtn = this.add.text(250, 460, "â–¶ï¸ Start Mission", { font: "18px monospace", fill: "#00ff00" })
      .setInteractive().on('pointerdown', () => {
        this.beep.play();
        this.easyMode = false;
        this.startGame(introContainer);
      });

    const easyBtn = this.add.text(450, 460, "ðŸ§© Easy Mode", { font: "18px monospace", fill: "#00ff00" })
      .setInteractive().on('pointerdown', () => {
        this.beep.play();
        this.easyMode = true;
        this.startGame(introContainer);
      });
    introContainer.add([startBtn, easyBtn]);
    const howToBtn = this.add.text(340, 500, "ðŸ“˜ How to Play", {
      font: "16px monospace",
      fill: "#00ff00"
    })
    .setInteractive()
    .on("pointerdown", () => {
      this.sound.play("beep");
      this.showHowToPlay();
    });
    introContainer.add(howToBtn);

// Keyboard shortcuts on intro screen
this.input.keyboard.on('keydown', (event) => {
  if (this.missionActive) return; // prevent triggering during game

  switch (event.key.toLowerCase()) {
    case 'enter':
      this.sound.play('beep');
      this.easyMode = false;
      this.startGame(introContainer);
      break;
    case 'e':
      this.sound.play('beep');
      this.easyMode = true;
      this.startGame(introContainer);
      break;
    case 'h':
      this.sound.play('beep');
      this.showHowToPlay();
      break;
      }
    });
}

  startGame(introContainer) { 
    introContainer.destroy(); 
    
    this.missionActive = true;
    this.startTime = this.time.now;
    this.log("> System: Mission started. Keep chaos under control!");
  }

handleCommand(cmd) {
  if (!this.missionActive) return;

if (cmd === "Tell me a joke") {
  this.jokeCount++;
  // Determine mood-based response
  const neutralJokes = [
    "Bot: I told the cloud a secretâ€¦ now itâ€™s leaking.",
    "Bot: Coffee is just bean juice. Think about it.",
    "Bot: I once tried meditationâ€¦ crashed at inner peace.exe."
  ];
  const sassyJokes = [
    "Bot: Again with the jokes? I'm not your stand-up circuit board!",
    "Bot: Do I look like a clown algorithm to you?",
    "Bot: I'm charging you 1 chaos point per joke now."
  ];
  const grumpyJokes = [
    "Bot: Too much chaos. Not enough RAM for humor.",
    "Bot: Iâ€™d laugh, but the office is on fire.",
    "Bot: Humor module offline. Try again later."
  ];
  const malfunctionJokes = [
    "Bot: 01001000 01100001 01101000 01100001â€¦ *glitches out*",
    "Bot: Hehâ€¦hehâ€¦what is 'funny'? Are we funny?",
    "Bot: SYSTEM HUMOR.EXE NOT FOUND."
  ];

  let jokeList = neutralJokes;
  if (this.personality === "sassy") jokeList = sassyJokes;
  else if (this.personality === "grumpy") jokeList = grumpyJokes;
  else if (this.personality === "malfunctioning") jokeList = malfunctionJokes;

  const joke = Phaser.Utils.Array.GetRandom(jokeList);
  this.log(`> ${joke}`);

  // Small effect
  if (this.personality === "neutral") this.chaos = Math.max(0, this.chaos - 2);
  if (this.personality === "sassy") this.chaos += 2;
  this.updateChaosBar();

  // Personality evolution rules
  if (this.jokeCount > 3 && this.personality === "neutral") {
    this.personality = "sassy";
    this.log("> Bot: I'm not a comedian, you know...");
  }

  return;
}
  // --- Shutdown restriction BEFORE counting ---
if (cmd === "Shutdown" && this.commandCount < 10) {
  const remaining = 10 - this.commandCount;
  this.log(`> Shutdown command locked. Complete ${remaining} more task${remaining > 1 ? "s" : ""} first.`);
  this.beep.play();
  return;
}

  // --- Count and repetition check ---
  if (this.lastCommand === cmd) {
    this.repeatCount++;
  } else {
    this.repeatCount = 1;
    this.lastCommand = cmd;
  }

  // If repeated too much, reject
  if (this.repeatCount > 3) {
    this.log(`> Bot bored of doing "${cmd}". Give another command!`);
    this.beep.play();
    return;
  }

  // Count valid commands (Shutdown excluded early)
  this.commandCount++;

  // --- Perform the task normally ---
  this.botMove();
  this.beep.play();

  const commandStats = {
    "Clean Desk": { points: 5, risk: 0.2 },
    "Organize Room": { points: 10, risk: 0.35 },
    "Fix Computer": { points: 20, risk: 0.45 },
    "Make Coffee": { points: 8, risk: 0.35 },
    "Save Project": { points: 15, risk: 0.55 },
    "Shutdown": { points: 25, risk: 0.6 },
    "Tell me a joke": { points: 0 } 
  };

  const stats = commandStats[cmd] || { points: 5, risk: 0.3 };
  let risk = stats.risk;
  let pts = stats.points;

  // Adjust by chaos state
  if (this.chaos > 70) risk += 0.15;
  if (this.chaos < 30) pts = Math.floor(pts * 1.5);

  const bad = Math.random() < (this.easyMode ? risk - 0.15 : risk);

if (bad) {
  const add = Phaser.Math.Between(8, 18);
  this.chaos += add;
  this.glitchFlash();

  
  const failResponses = [
    `Bot: Misinterpreted "${cmd}" again... oops.`,
    `Bot: Uh... I think I broke it.`,
    `Bot: Not my fault! Probably.`,
  ];
  this.log(`> ${Phaser.Utils.Array.GetRandom(failResponses)} Chaos +${add}%`);
} else {
  const reduce = Phaser.Math.Between(2, 6);
  this.chaos = Math.max(0, this.chaos - reduce);
  this.score += pts;

  const successResponses = [
    `Bot: "${cmd}" executed flawlessly.`,
    `Bot: Task complete. Efficiency rising.`,
    `Bot: I live to serve... mostly.`,
  ];
  this.log(`> ${Phaser.Utils.Array.GetRandom(successResponses)} +${pts} pts | Chaos -${reduce}%`);
}

  this.updateChaosBar();

  // Special case: Shutdown ends mission safely
  if (cmd === "Shutdown" && this.chaos < 40 && !bad) {
    this.log("> Shutdown sequence completed. Mission success!");
    this.endGame(true);
  }
}
  botMove(){
    const x=Phaser.Math.Between(100,700), y=Phaser.Math.Between(150,400);
    this.tweens.add({ targets:this.bot, x, y, duration:300, ease:"Sine.easeInOut" });
  }

    glitchFlash(){
    this.glitch.setAlpha(0.8);
    this.glitch.setTint(0xff00ff); 
    this.cameras.main.shake(100, 0.01); 
    this.tweens.add({
        targets: this.glitch,
        alpha: 0,
        duration: 500,
        onComplete: () => this.glitch.clearTint()
    });
    }
  log(msg){
    const lines=this.logText.text.split("\n");
    if(lines.length>10)lines.shift(); lines.push(msg);
    this.logText.setText(lines.join("\n"));
  }

updateChaosBar() {
  this.chaosBar.width = (this.chaos / 100) * 760;
  this.chaosLabel.setText(`Chaos Level: ${Math.floor(this.chaos)}%`);
  
  // Color logic
  const oldColor = this.chaosBar.fillColor;
  const newColor =
    this.chaos < 30 ? 0x00ff00 :
    this.chaos < 70 ? 0xffff00 :
    0xff0000;
  this.chaosBar.fillColor = newColor;

  if (newColor !== oldColor) {
    this.tweens.add({
      targets: this.chaosBar,
      alpha: { from: 0.5, to: 1 },
      duration: 150,
      repeat: 2,
      yoyo: true,
    });
  }

  if (this.chaos >= 100) this.endGame(false);

  // Updates personality dynamically
  const prevPersonality = this.personality;
  if (this.chaos > 80) this.personality = "malfunctioning";
  else if (this.chaos > 60) this.personality = "grumpy";
  else if (this.personality !== "sassy") this.personality = "neutral";

  if (this.personality !== prevPersonality) {
    this.log(`> âš  Personality drift detected: Bot is now ${this.personality.toUpperCase()}.`);
  }
}

endGame(success) {
 this.missionActive = false;
 this.bot.setTint(success ? 0x00ff00 : 0xff0000);
 this.bgMusic?.stop();
 this.beep.stop();

if (success) {
 this.log("> Mission Complete! System stable.");
 this.sound.play("beep");
//Updates high score ONLY on success
 if (this.score > this.highScore) {
 this.highScore = this.score;
 localStorage.setItem('bot_high_score', this.highScore);
 this.log(`> New High Score: ${this.highScore}!`);
}
} else {
 this.log("> System Failure! Office in ruins.");
 this.boom.play();
}
  this.showGameOver(success);
// Keyboard shortcut to restart after game over
this.input.keyboard.once('keydown-R', () => {
  this.sound.play('beep');
  this.scene.restart();
});
}

// GAME OVER OVERLAY
showGameOver(success) {
  // Dim background
  const overlay = this.add.rectangle(
    this.cameras.main.centerX,
    this.cameras.main.centerY,
    this.scale.width,
    this.scale.height,
    0x000000,
    0.7
  ).setScrollFactor(0).setDepth(100);

  // Text headline
  const title = success ? "MISSION COMPLETE" : "SYSTEM FAILURE";
  const color = success ? "#00ff88" : "#ff4444";

  const titleText = this.add.text(
    this.cameras.main.centerX,
    this.cameras.main.centerY - 40,
    title,
    { font: "42px monospace", fill: color }
  ).setOrigin(0.5).setDepth(101);

  // Subtext
  const msg = success
    ? "Office stabilized. Bot under control"
    : "Bot went rogue. Office destroyed";
  const subText = this.add.text(
    this.cameras.main.centerX,
    this.cameras.main.centerY + 10,
    msg,
    { font: "20px monospace", fill: "#cccccc" }
  ).setOrigin(0.5).setDepth(101);

  const restartAction = () => {
   this.sound.play("beep");
   this.scene.restart();
  };

  const btn = this.add.text(
    this.cameras.main.centerX,
    this.cameras.main.centerY + 70,
    "â–¶ RESTART MISSION (Enter)",
    { font: "22px monospace", fill: "#00ff00", backgroundColor: "#003300", padding: { x: 10, y: 5 } }
  )
    .setOrigin(0.5)
    .setDepth(101)
    .setInteractive()
    .on("pointerdown", restartAction) // Mouse click listener
    .on("pointerover", () => btn.setStyle({ fill: "#ffffff" }))
    .on("pointerout", () => btn.setStyle({ fill: "#00ff00" }));

  // restart keyboard listener
  this.input.keyboard.once('keydown-ENTER', restartAction);

  // Pulsing animation
  this.tweens.add({
    targets: [titleText],
    scale: { from: 0.9, to: 1.1 },
    duration: 700,
    yoyo: true,
    repeat: -1,
    ease: "Sine.easeInOut"
  });

  // highscore display
  const scoreDisplay = this.add.text(
    this.cameras.main.centerX,
    this.cameras.main.centerY + 40,
    `Your Score: ${this.score} | High Score: ${this.highScore}`,
    { font: "18px monospace", fill: "#00ff00" }
  ).setOrigin(0.5).setDepth(101);
}
  update() {
  if (!this.missionActive) return; 

  const t = Math.floor((this.time.now - this.startTime) / 1000);
  this.timerText.setText(`Time: ${t}s | Score: ${this.score}`);

  // Chaos slowly increases over time
  if (t % (this.easyMode ? 6 : 4) === 0 && Math.random() < 0.002) {
    this.chaos += 1;
    this.updateChaosBar();
  }
}
}

new Phaser.Game({ type:Phaser.AUTO, width:800, height:620, backgroundColor:"#111", scene:BotScene });
</script>

</body>
</html>

